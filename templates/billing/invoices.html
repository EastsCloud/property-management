
{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h4>账单</h4>
  <a class="btn btn-primary" href="{{ url_for('invoices_new') }}">+ 新建账单</a>
</div>
<table class="table table-hover mt-2">
  <thead><tr><th>ID</th><th>业主</th><th>费用名称</th><th>计费周期</th><th>单价</th><th>费用金额(月)</th><th>已缴费</th><th>还需缴费</th><th>到期日</th><th>支付状态</th></tr></thead>
  <tbody>
  {% for i in invoices %}
    {% set paid_amount = invoice_paid.get(i.id, 0) if invoice_paid else 0 %}
    <tr>
      <td>{{ i.id }}</td>
      <td><a href="{{ url_for('owners_detail', oid=i.owner_id) }}">{{ i.owner.name }}</a></td>
      <td>{{ i.charge_type.name if i.charge_type else (i.description or '-') }}</td>
      <td>{{ i.billing_cycle or (i.charge_type.billing_cycle if i.charge_type else '-') }}</td>
      <td>¥{{ '%.2f'|format(i.price or (i.charge_type.price if i.charge_type else 0)) }}</td>
      <td>¥{{ '%.2f'|format(i.amount) }}</td>
      <td>¥{{ '%.2f'|format(paid_amount) }}</td>
      <td><strong class="text-{{ 'success' if i.unpaid_amount == 0 else 'danger' }}">¥{{ '%.2f'|format(i.unpaid_amount or i.amount) }}</strong></td>
      <td>{{ i.due_date }}</td>
      <td><span class="badge text-bg-{{ 'success' if i.status=='已支付' else 'warning' }}">{{ i.status }}</span></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
